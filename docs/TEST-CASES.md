# 测试用例 — cticloud-agentsdk-demo

> 角色：陆测 (Test Agent)
> 更新时间：2026-02-22 北京时间

---

## 📋 测试用例清单

### 一、登录/登出模块

| ID | 场景 | 前置条件 | 测试步骤 | 期望结果 | 优先级 |
|----|------|----------|----------|----------|--------|
| TC-001 | 登录成功 | env.json 配置正确 | 1. 打开页面 2. 点击"登录"按钮 | code=0，状态显示"空闲"，事件面板出现 AGENT_STATUS 事件 | P0 |
| TC-002 | 登录失败-无效 sessionKey | sessionKey 设置为无效值 | 1. 修改配置 2. 点击"登录" | code!=0，显示错误提示，事件面板记录错误 | P0 |
| TC-003 | 登录失败-网络不可达 | baseURL 设置为无效地址 | 1. 修改配置 2. 点击"登录" | Promise reject，显示异常提示 | P1 |
| TC-004 | 登录失败-缺少必填参数 | 清空 tenantId | 1. 修改配置 2. 点击"登录" | code!=0 或 Promise reject | P1 |
| TC-005 | 登出成功 | 已登录状态 | 1. 点击"登出"按钮 | 状态显示"离线"，事件面板出现 LOGOUT 事件 | P0 |
| TC-006 | 登出后状态清理 | 已登录并有过通话 | 1. 登出 2. 检查界面状态 | 所有状态重置，事件保留 | P1 |

### 二、预览外呼模块

| ID | 场景 | 前置条件 | 测试步骤 | 期望结果 | 优先级 |
|----|------|----------|----------|----------|--------|
| TC-010 | 外呼成功-完整流程 | 已登录，状态为空闲 | 1. 点击"外呼"按钮 | 收到 START → RINGING → BRIDGE → RESULT 事件序列 | P0 |
| TC-011 | 外呼失败-号码非法 | customerNumber 设置为"123" | 1. 点击"外呼" | code!=0，显示错误提示 | P1 |
| TC-012 | 外呼失败-非空闲状态 | 状态为忙碌/通话中 | 1. 尝试点击"外呼" | 按钮禁用，无法点击 | P1 |
| TC-013 | 外呼超时处理 | 被叫号码不可达 | 1. 发起外呼 2. 等待超时 | 收到 RESULT 事件，result 为失败 | P2 |
| TC-014 | 外呼按钮状态 | 未登录 | 1. 检查"外呼"按钮状态 | 按钮禁用 | P1 |

### 三、软电话模块

| ID | 场景 | 前置条件 | 测试步骤 | 期望结果 | 优先级 |
|----|------|----------|----------|----------|--------|
| TC-020 | 接听成功 | endpointType=3，设备振铃(deviceStatus=3) | 1. 点击"接听"按钮 | sipLink 成功，状态变为"通话中"，Toast 提示"已接听" | P0 |
| TC-021 | 接听失败-非软电话模式 | endpointType=1(PSTN) | 1. 振铃时检查"接听"按钮 | 按钮禁用 | P1 |
| TC-022 | 接听失败-非振铃状态 | 状态为空闲 | 1. 检查"接听"按钮状态 | 按钮禁用 | P1 |
| TC-023 | 挂断成功 | 通话中状态 | 1. 点击"挂断"按钮 | sipUnlink 成功，状态变为空闲，Toast 提示"已挂断" | P0 |
| TC-024 | 挂断失败-非通话状态 | 状态为空闲 | 1. 检查"挂断"按钮状态 | 按钮禁用 | P1 |
| TC-025 | 软电话连接异常 | 网络中断 | 1. 通话中断开网络 | 收到断线事件，显示提示 | P2 |

### 四、事件订阅模块

| ID | 场景 | 前置条件 | 测试步骤 | 期望结果 | 优先级 |
|----|------|----------|----------|----------|--------|
| TC-030 | AGENT_STATUS 事件 | 已登录 | 1. 触发状态变更 | 事件面板显示事件，状态正确更新 | P0 |
| TC-031 | PREVIEW_OBCALL 事件序列 | 发起外呼 | 1. 观察事件面板 | 按序收到 START/RINGING/BRIDGE/RESULT | P0 |
| TC-032 | RINGING 来电事件 | 有来电 | 1. 观察事件面板 | 显示 RINGING 事件，包含来电信息 | P1 |
| TC-033 | RECONNECT_ATTEMPT 事件 | 网络断开后重连 | 1. 断网后恢复 | 显示重连事件，包含尝试次数 | P2 |
| TC-034 | WEBRTC_STATS 事件 | 软电话通话中 | 1. 观察事件和指标面板 | 每秒收到指标，面板显示 jitter/rtt/packetLoss | P1 |
| TC-035 | TRANSCRIPT 转写事件 | 启用转写的通话 | 1. 通话中说话 | 收到转写事件，包含文本内容 | P2 |

### 五、UI/交互模块

| ID | 场景 | 前置条件 | 测试步骤 | 期望结果 | 优先级 |
|----|------|----------|----------|----------|--------|
| TC-040 | 配置面板打开 | 页面加载完成 | 1. 点击"配置"按钮 | Offcanvas 面板滑出，显示所有配置项 | P1 |
| TC-041 | 配置保存 | 打开配置面板 | 1. 修改配置 2. 点击"应用配置" | 配置保存到 localStorage，Toast 提示成功 | P1 |
| TC-042 | 事件过滤 | 有多条事件 | 1. 选择过滤条件"坐席状态" | 只显示 AGENT_STATUS 相关事件 | P2 |
| TC-043 | 事件详情展开 | 有事件记录 | 1. 点击事件行 | 展开显示完整 JSON 数据 | P2 |
| TC-044 | 事件清空 | 有事件记录 | 1. 点击清空按钮 | 所有事件被清除 | P2 |
| TC-045 | 主题切换 | 页面加载完成 | 1. 点击主题切换按钮 | 明/暗主题切换，背景色变化 | P3 |
| TC-046 | Toast 提示自动消失 | 触发任意操作 | 1. 观察提示 | 4 秒后自动消失 | P2 |

### 六、一键自测模块

| ID | 场景 | 前置条件 | 测试步骤 | 期望结果 | 优先级 |
|----|------|----------|----------|----------|--------|
| TC-050 | 一键自测完整流程 | env.json 配置正确 | 1. 点击"一键自测" | 自动执行 登录→外呼→接听→挂断→登出 | P0 |
| TC-051 | 一键自测-URL 参数触发 | 无 | 1. 访问 ?autotest=1 | 页面加载 1 秒后自动开始测试 | P1 |
| TC-052 | 一键自测-登录失败中断 | sessionKey 无效 | 1. 点击"一键自测" | 登录失败后停止，显示错误提示 | P1 |
| TC-053 | 一键自测按钮状态 | 自测进行中 | 1. 检查按钮状态 | 按钮禁用，显示"自测中..." | P2 |

### 七、异常/边界场景

| ID | 场景 | 前置条件 | 测试步骤 | 期望结果 | 优先级 |
|----|------|----------|----------|----------|--------|
| TC-060 | 重复登录 | 已登录状态 | 1. 再次点击"登录" | 按钮禁用，无法重复登录 | P1 |
| TC-061 | 未登录操作 | 未登录状态 | 1. 尝试外呼/接听/挂断 | 所有按钮禁用 | P1 |
| TC-062 | 事件面板性能 | 累计 200+ 事件 | 1. 观察页面性能 | 事件自动截断，页面不卡顿 | P2 |
| TC-063 | 敏感信息脱敏 | 日志打印 | 1. 查看事件详情 | sessionKey 显示为 "***" | P1 |
| TC-064 | 页面刷新后配置保持 | 已保存配置 | 1. 刷新页面 | 从 localStorage 恢复配置 | P2 |

---

## 📊 测试覆盖率

| 模块 | 用例数 | P0 | P1 | P2 | P3 |
|------|--------|----|----|----|----|
| 登录/登出 | 6 | 2 | 3 | 0 | 1 |
| 预览外呼 | 5 | 1 | 3 | 1 | 0 |
| 软电话 | 6 | 2 | 2 | 2 | 0 |
| 事件订阅 | 6 | 2 | 2 | 2 | 0 |
| UI/交互 | 7 | 0 | 2 | 4 | 1 |
| 一键自测 | 4 | 1 | 2 | 1 | 0 |
| 异常/边界 | 5 | 0 | 2 | 3 | 0 |
| **合计** | **39** | **8** | **16** | **13** | **2** |

---

## 🔧 测试环境

| 项目 | 值 |
|------|-----|
| 测试环境 | http://localhost:5173 |
| 目标浏览器 | Chrome 最新稳定版 |
| SDK 环境 | http://agent-gateway-hs-dev.cticloud.cn |
| 测试账号 | tenantId: 6000001, agentNo: 1865 |

---

*测试用例设计：陆测*
*日期：2026-02-22 北京时间*
